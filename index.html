<!DOCTYPE html>
<html>
<head>
    <title>Roblox Web Ultimate Edition</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; cursor: crosshair; }
        #gui { position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; border: 2px solid #ff0000; pointer-events: none; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 8px; height: 8px; background: white; border-radius: 50%; transform: translate(-50%, -50%); border: 1px solid black; }
        #flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; pointer-events: none; transition: opacity 0.1s; z-index: 2000; }
        
        /* Telefon Tasarımı */
        #phone { position: absolute; bottom: 20px; right: 20px; width: 220px; height: 400px; background: #222; border: 5px solid #444; border-radius: 30px; display: none; flex-direction: column; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        #phone-view { flex: 1; background: #000; position: relative; }
        #cam-btn { width: 60px; height: 60px; background: white; border-radius: 50%; margin: 10px auto; cursor: pointer; border: 4px solid #888; }
        #cam-btn:active { background: #ff0000; }
    </style>
</head>
<body>
    <div id="flash"></div>
    <div id="gui">
        <h2 style="margin:0; color: #f44336;">ROBLOX PRO MAX</h2>
        <hr>
        <b>WASD:</b> Yürü | <b>SHIFT:</b> Koş<br>
        <b>SPACE:</b> Zıpla | <b>P:</b> Telefon<br>
        <b>MİSYON:</b> Parkuru bitir, NPC'lerle takıl!
    </div>
    <div id="crosshair"></div>

    <div id="phone">
        <div style="color:white; text-align:center; padding: 5px; font-size: 12px;">CAMERA MODE</div>
        <div id="phone-view"><canvas id="phone-canvas"></canvas></div>
        <div id="cam-btn"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x80aaff);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Işıklandırma
        const ambient = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambient);
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(10, 50, 10);
        sun.castShadow = true;
        scene.add(sun);

        // Zemin
        const floorGeo = new THREE.PlaneGeometry(500, 500);
        const floorMat = new THREE.MeshPhongMaterial({ color: 0x3b3b3b });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);
        scene.add(new THREE.GridHelper(500, 100, 0x555555, 0x444444));

        // --- KARAKTER SİSTEMİ ---
        const playerGroup = new THREE.Group();
        const body = new THREE.Mesh(new THREE.BoxGeometry(1, 1.2, 0.5), new THREE.MeshPhongMaterial({color: 0x0055ff}));
        body.position.y = 1.6;
        const head = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.7, 0.7), new THREE.MeshPhongMaterial({color: 0xffcc00}));
        head.position.y = 2.55;
        playerGroup.add(body, head);
        scene.add(playerGroup);

        // --- NPC SİSTEMİ (HAREKETLİ) ---
        const npcs = [];
        function spawnNPC(x, z, color) {
            const n = new THREE.Group();
            const b = new THREE.Mesh(new THREE.BoxGeometry(1, 1.2, 0.5), new THREE.MeshPhongMaterial({color: color}));
            b.position.y = 1.6;
            const h = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.7, 0.7), new THREE.MeshPhongMaterial({color: 0xffcc00}));
            h.position.y = 2.55;
            n.add(b, h);
            n.position.set(x, 0, z);
            scene.add(n);
            npcs.push({obj: n, angle: Math.random() * Math.PI * 2});
        }
        spawnNPC(5, -5, 0xff00ff);
        spawnNPC(-10, -10, 0x00ff00);
        spawnNPC(15, -2, 0xff5500);

        // --- BLOKLAR (ÇARPIŞMA DAHİL) ---
        const platforms = [];
        function addBox(w, h, d, x, y, z, color, isLava = false) {
            const mesh = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), new THREE.MeshPhongMaterial({color: color, emissive: isLava ? color : 0, emissiveIntensity: 0.5}));
            mesh.position.set(x, y, z);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            mesh.userData = { isLava: isLava, height: h };
            scene.add(mesh);
            platforms.push(mesh);
        }

        // Parkur
        addBox(5, 1, 5, 0, 0.5, -10, 0x00ff00);
        addBox(5, 1, 5, 8, 2, -15, 0x0000ff);
        addBox(5, 1, 5, 0, 4, -20, 0xffff00);
        addBox(10, 0.5, 10, 0, 0.25, -35, 0xff0000, true); // LAV
        addBox(5, 10, 5, -15, 5, -20, 0x888888); // Büyük Kule

        // --- KONTROLLER ---
        let velocityY = 0;
        let isGrounded = true;
        const keys = {};
        document.addEventListener('keydown', e => {
            keys[e.code] = true;
            if(e.code === 'KeyP') togglePhone();
        });
        document.addEventListener('keyup', e => keys[e.code] = false);
        document.body.onclick = () => { if(!phoneOpen) document.body.requestPointerLock(); };

        let yaw = 0;
        document.addEventListener('mousemove', e => {
            if(document.pointerLockElement) {
                yaw -= e.movementX * 0.003;
                playerGroup.rotation.y = yaw;
            }
        });

        // --- TELEFON VE FOTOĞRAF ---
        let phoneOpen = false;
        const phoneElem = document.getElementById('phone');
        const phoneCam = new THREE.PerspectiveCamera(60, 220/330, 0.1, 100);
        const phoneRenderer = new THREE.WebGLRenderer({canvas: document.getElementById('phone-canvas')});
        phoneRenderer.setSize(220, 330);

        function togglePhone() {
            phoneOpen = !phoneOpen;
            phoneElem.style.display = phoneOpen ? 'flex' : 'none';
            if(phoneOpen) document.exitPointerLock();
        }

        document.getElementById('cam-btn').onclick = () => {
            document.getElementById('flash').style.opacity = '1';
            setTimeout(() => document.getElementById('flash').style.opacity = '0', 100);
            console.log("FOTOĞRAF KAYDEDİLDİ (Simüle)");
        };

        // --- OYUN DÖNGÜSÜ ---
        const raycaster = new THREE.Raycaster();
        function animate() {
            requestAnimationFrame(animate);

            // Hareket
            const speed = keys['ShiftLeft'] ? 0.3 : 0.15;
            if(keys['KeyW']) playerGroup.translateZ(-speed);
            if(keys['KeyS']) playerGroup.translateZ(speed);
            if(keys['KeyA']) playerGroup.translateX(-speed);
            if(keys['KeyD']) playerGroup.translateX(speed);

            // Yerçekimi ve Çarpışma
            velocityY -= 0.015;
            playerGroup.position.y += velocityY;

            isGrounded = false;
            if(playerGroup.position.y <= 0) {
                playerGroup.position.y = 0;
                velocityY = 0;
                isGrounded = true;
            }

            // Platform Üstünde Durma
            raycaster.set(new THREE.Vector3(playerGroup.position.x, playerGroup.position.y + 1, playerGroup.position.z), new THREE.Vector3(0, -1, 0));
            const intersects = raycaster.intersectObjects(platforms);
            if(intersects.length > 0 && intersects[0].distance < 1.1) {
                const obj = intersects[0].object;
                if(obj.userData.isLava) {
                    playerGroup.position.set(0,0,0); // Öldün
                } else {
                    playerGroup.position.y = obj.position.y + (obj.userData.height/2);
                    velocityY = 0;
                    isGrounded = true;
                }
            }

            if(keys['Space'] && isGrounded) {
                velocityY = 0.35;
                isGrounded = false;
            }

            // NPC'leri Oynat
            npcs.forEach(npc => {
                npc.angle += 0.02;
                npc.obj.position.x += Math.sin(npc.angle) * 0.05;
                npc.obj.rotation.y += 0.01;
            });

            // Kamera
            camera.position.lerp(new THREE.Vector3().copy(playerGroup.position).add(new THREE.Vector3(0, 5, 10).applyQuaternion(playerGroup.quaternion)), 0.1);
            camera.lookAt(playerGroup.position.x, playerGroup.position.y + 2, playerGroup.position.z);

            if(phoneOpen) {
                phoneCam.position.copy(playerGroup.position).add(new THREE.Vector3(0, 2, -2).applyQuaternion(playerGroup.quaternion));
                phoneCam.lookAt(playerGroup.position);
                phoneRenderer.render(scene, phoneCam);
            }

            renderer.render(scene, camera);
        }
        animate();

        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>