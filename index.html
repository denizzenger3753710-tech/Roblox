<!DOCTYPE html>
<html>
<head>
    <title>Roblox Web Ultimate - Final Edition</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; cursor: crosshair; }
        #gui { position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 12px; border: 3px solid #00aff0; pointer-events: none; z-index: 100; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; }
        #flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; pointer-events: none; transition: opacity 0.1s; z-index: 3000; }
        
        /* Geli≈ümi≈ü Telefon GUI */
        #phone { 
            position: absolute; bottom: 30px; right: 30px; width: 260px; height: 500px; 
            background: #1a1a1a; border: 8px solid #333; border-radius: 40px; 
            display: none; flex-direction: column; overflow: hidden; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.8); z-index: 2000;
        }
        #phone-header { height: 40px; background: #222; display: flex; justify-content: space-around; align-items: center; color: white; font-size: 12px; }
        #phone-screen { flex: 1; background: linear-gradient(180deg, #3498db, #8e44ad); position: relative; padding: 20px; }
        #camera-app-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; }
        
        .app-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .app-icon { 
            width: 50px; height: 50px; background: white; border-radius: 12px; 
            display: flex; justify-content: center; align-items: center; font-size: 24px; cursor: pointer;
            transition: transform 0.2s;
        }
        .app-icon:hover { transform: scale(1.1); }
        
        #cam-shutter { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 60px; background: white; border-radius: 50%; border: 5px solid #ccc; display: none;
        }
        #home-btn { height: 40px; background: #222; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        #home-dot { width: 30px; height: 5px; background: #555; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="flash"></div>
    <div id="gui">
        <h2 style="margin:0; color: #00aff0;">ROBLOX WEB OS</h2>
        <div style="font-size: 12px; opacity: 0.8;">Versiyon: 2026.1.Final</div>
        <hr style="border: 0; border-top: 1px solid #444; margin: 10px 0;">
        <b>W,A,S,D:</b> Ko≈üma | <b>SPACE:</b> Zƒ±pla<br>
        <b>SHIFT:</b> Turbo | <b>P:</b> Telefonu A√ß
    </div>
    <div id="crosshair"></div>

    <div id="phone">
        <div id="phone-header"><span>12:00</span><span>üì∂ üîã</span></div>
        <div id="phone-screen" id="app-manager">
            <div class="app-grid" id="main-menu">
                <div class="app-icon" onclick="openCamera()" title="Kamera">üì∏</div>
                <div class="app-icon" style="background: #2ecc71;">üéÆ</div>
                <div class="app-icon" style="background: #e74c3c;">‚ù§Ô∏è</div>
                <div class="app-icon" style="background: #f1c40f;">üí¨</div>
                <div class="app-icon" style="background: #9b59b6;">üéµ</div>
                <div class="app-icon" style="background: #34495e;">‚öôÔ∏è</div>
            </div>
            <canvas id="camera-app-view"></canvas>
            <div id="cam-shutter" onclick="takePhoto()"></div>
        </div>
        <div id="home-btn" onclick="goHome()"><div id="home-dot"></div></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- SAHNE KURULUMU ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xaaccff);
        scene.fog = new THREE.Fog(0xaaccff, 20, 100); // Sis efekti (Roblox havasƒ±)

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // I≈üƒ±klar
        scene.add(new THREE.AmbientLight(0xffffff, 0.6));
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(20, 50, 20);
        light.castShadow = true;
        scene.add(light);

        // Baseplate
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000), new THREE.MeshPhongMaterial({ color: 0x444444 }));
        floor.rotation.x = -Math.PI/2;
        floor.receiveShadow = true;
        scene.add(floor);
        scene.add(new THREE.GridHelper(1000, 100, 0x666666, 0x555555));

        // --- KARAKTER ---
        const player = new THREE.Group();
        const torso = new THREE.Mesh(new THREE.BoxGeometry(1, 1.2, 0.5), new THREE.MeshPhongMaterial({color: 0x00aff0}));
        torso.position.y = 1.6;
        const head = new THREE.Mesh(new THREE.BoxGeometry(0.75, 0.75, 0.75), new THREE.MeshPhongMaterial({color: 0xffcc00}));
        head.position.y = 2.6;
        player.add(torso, head);
        scene.add(player);

        // --- D√úNYA OBJELERƒ∞ ---
        const platforms = [];
        function createBlock(w, h, d, x, y, z, color, type = "normal") {
            const mesh = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), new THREE.MeshPhongMaterial({color: color}));
            mesh.position.set(x, y, z);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            mesh.userData = { type: type, h: h };
            scene.add(mesh);
            platforms.push(mesh);
        }

        // Parkur Parkuru
        createBlock(6, 1, 6, 0, 0.5, -15, 0x2ecc71);
        createBlock(4, 1, 4, 8, 3, -25, 0x3498db);
        createBlock(4, 1, 4, 0, 6, -35, 0xf1c40f);
        createBlock(15, 0.5, 15, 0, 0.25, -60, 0xe74c3c, "lava"); // DEV LAV
        
        // U√ßan Adalar (G√ºzellik i√ßin)
        for(let i=0; i<10; i++) {
            createBlock(10, 2, 10, Math.random()*100-50, 15 + Math.random()*10, -50 - Math.random()*50, 0xffffff);
        }

        // NPC'ler
        const npcs = [];
        const npcColors = [0xff00ff, 0x00ff00, 0xff5500];
        npcColors.forEach((c, i) => {
            const n = player.clone();
            n.children[0].material = new THREE.MeshPhongMaterial({color: c});
            n.position.set(5 + i*5, 0, 5);
            scene.add(n);
            npcs.push({obj: n, offset: Math.random()*10});
        });

        // --- KONTROLLER & Fƒ∞Zƒ∞K ---
        let velY = 0;
        let grounded = true;
        const keys = {};
        document.addEventListener('keydown', e => {
            keys[e.code] = true;
            if(e.code === 'KeyP') togglePhone();
        });
        document.addEventListener('keyup', e => keys[e.code] = false);

        let mouseYaw = 0;
        document.addEventListener('mousemove', e => {
            if(document.pointerLockElement) {
                mouseYaw -= e.movementX * 0.003;
                player.rotation.y = mouseYaw;
            }
        });

        // --- TELEFON FONKSƒ∞YONLARI ---
        const phone = document.getElementById('phone');
        const camView = document.getElementById('camera-app-view');
        const mainMenu = document.getElementById('main-menu');
        const shutter = document.getElementById('cam-shutter');
        let phoneOpen = false;

        const phoneCam = new THREE.PerspectiveCamera(60, 260/420, 0.1, 100);
        const phoneRenderer = new THREE.WebGLRenderer({canvas: camView});
        phoneRenderer.setSize(260, 420);

        function togglePhone() {
            phoneOpen = !phoneOpen;
            phone.style.display = phoneOpen ? 'flex' : 'none';
            if(!phoneOpen) goHome();
            if(phoneOpen) document.exitPointerLock();
        }

        function openCamera() {
            mainMenu.style.display = 'none';
            camView.style.display = 'block';
            shutter.style.display = 'block';
        }

        function goHome() {
            mainMenu.style.display = 'grid';
            camView.style.display = 'none';
            shutter.style.display = 'none';
        }

        function takePhoto() {
            document.getElementById('flash').style.opacity = 1;
            setTimeout(() => document.getElementById('flash').style.opacity = 0, 100);
        }

        // --- RENDER D√ñNG√úS√ú ---
        const raycaster = new THREE.Raycaster();
        function update() {
            requestAnimationFrame(update);

            // Hareket
            const speed = keys['ShiftLeft'] ? 0.4 : 0.18;
            if(keys['KeyW']) player.translateZ(-speed);
            if(keys['KeyS']) player.translateZ(speed);
            if(keys['KeyA']) player.translateX(-speed);
            if(keys['KeyD']) player.translateX(speed);

            // Fizik
            velY -= 0.02;
            player.position.y += velY;

            grounded = false;
            if(player.position.y <= 0) {
                player.position.y = 0;
                velY = 0;
                grounded = true;
            }

            // √áarpƒ±≈üma Testi
            raycaster.set(new THREE.Vector3(player.position.x, player.position.y + 1, player.position.z), new THREE.Vector3(0, -1, 0));
            const hits = raycaster.intersectObjects(platforms);
            if(hits.length > 0 && hits[0].distance < 1.1) {
                const p = hits[0].object;
                if(p.userData.type === "lava") {
                    player.position.set(0, 10, 0); // Respawn
                } else {
                    player.position.y = p.position.y + (p.userData.h/2);
                    velY = 0;
                    grounded = true;
                }
            }

            if(keys['Space'] && grounded) velY = 0.4;

            // NPC Animasyon
            npcs.forEach((n, i) => {
                n.obj.position.y = Math.abs(Math.sin(Date.now()*0.005 + n.offset)) * 0.5;
                n.obj.rotation.y += 0.02;
            });

            // Kamera Takibi
            const camPos = new THREE.Vector3(0, 5, 12).applyQuaternion(player.quaternion).add(player.position);
            camera.position.lerp(camPos, 0.1);
            camera.lookAt(player.position.x, player.position.y + 2, player.position.z);

            // Telefon Render
            if(phoneOpen && camView.style.display === 'block') {
                phoneCam.position.copy(player.position).add(new THREE.Vector3(0, 3, -5).applyQuaternion(player.quaternion));
                phoneCam.lookAt(player.position.x, player.position.y + 1.5, player.position.z);
                phoneRenderer.render(scene, phoneCam);
            }

            renderer.render(scene, camera);
        }

        document.body.onclick = () => { if(!phoneOpen) document.body.requestPointerLock(); };
        update();

        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>