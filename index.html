<!DOCTYPE html>
<html>
<head>
    <title>Roblox Web Clone - The Ultimate Obby!</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; cursor: none; }
        #gui { 
            position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.7); 
            padding: 15px; border-radius: 10px; border: 2px solid #555; pointer-events: none; 
            font-size: 1.1em; line-height: 1.6;
            transition: opacity 0.3s ease-in-out;
        }
        #gui.hidden { opacity: 0; }
        #crosshair { 
            position: absolute; top: 50%; left: 50%; width: 6px; height: 6px; 
            background: white; border-radius: 50%; transform: translate(-50%, -50%); 
            z-index: 1000; pointer-events: none;
        }
        #phone-overlay {
            position: absolute; bottom: 10px; right: 10px; 
            width: 250px; height: 450px; background: black; border-radius: 30px; 
            border: 8px solid #333; box-shadow: 0 0 30px rgba(0,0,0,0.5);
            display: none; /* Ba≈ülangƒ±√ßta gizli */
            z-index: 999;
            overflow: hidden;
            pointer-events: all;
        }
        #phone-screen {
            width: 100%; height: calc(100% - 70px); background: #eee;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9em;
            color: #555;
            text-align: center;
        }
        #phone-camera-view {
            width: 100%; height: 100%;
            background-color: #333; /* Placeholder for camera feed */
            position: absolute;
            top: 0; left: 0;
            overflow: hidden;
        }
        #phone-camera-button {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 60px; background: white; border-radius: 50%;
            border: 5px solid #ccc; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            font-size: 2em; color: #333;
        }
        #phone-camera-button:active { background: #eee; border-color: #bbb; }
        #phone-top-bar, #phone-bottom-bar {
            height: 35px; background: #333; color: white;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; font-size: 0.8em;
        }
        #phone-top-bar { border-top-left-radius: 20px; border-top-right-radius: 20px; }
        #phone-bottom-bar { border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; }
    </style>
</head>
<body>
    <div id="gui">
        <h2 style="margin:0 0 10px 0; color: #f44336; text-shadow: 1px 1px 2px rgba(0,0,0,0.4);">ROBLOX JS</h2>
        <b>WASD:</b> Hareket<br>
        <b>SHIFT:</b> Hƒ±zlƒ± Ko≈ü<br>
        <b>SPACE:</b> Zƒ±pla<br>
        <b>MOUSE:</b> Bakƒ±≈ü (Ekrana Tƒ±kla)<br>
        <b>P:</b> Telefonu A√ß/Kapat
    </div>
    <div id="crosshair"></div>

    <div id="phone-overlay">
        <div id="phone-top-bar"><span>9:41 AM</span><span>üì∂üîã</span></div>
        <div id="phone-screen">
            <canvas id="phone-camera-view"></canvas>
            <div id="phone-camera-button">üì∏</div>
        </div>
        <div id="phone-bottom-bar"><span>üè°</span><span>üí¨</span><span>üì∑</span></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- SAHNE VE AYARLAR ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x80aaff); // Klasik g√∂ky√ºz√º mavisi
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // G√∂lgeler!
        document.body.appendChild(renderer.domElement);

        // Telefon i√ßin ayrƒ± bir renderer ve sahne (kamera g√∂r√ºnt√ºs√º i√ßin)
        const phoneCamera = new THREE.PerspectiveCamera(60, 250 / (450 - 70), 0.1, 500);
        const phoneRenderer = new THREE.WebGLRenderer({ antialias: true, canvas: document.getElementById('phone-camera-view') });
        phoneRenderer.setSize(250, 450 - 70);
        phoneRenderer.shadowMap.enabled = true;

        // --- I≈ûIKLANDIRMA (G√ºne≈ü gibi) ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const sun = new THREE.DirectionalLight(0xffffff, 0.8);
        sun.position.set(50, 100, 50); // G√ºne≈üin konumu
        sun.castShadow = true;
        // G√∂lge ayarlarƒ± (daha iyi kalite i√ßin)
        sun.shadow.mapSize.width = 2048;
        sun.shadow.mapSize.height = 2048;
        sun.shadow.camera.near = 0.5;
        sun.shadow.camera.far = 200;
        sun.shadow.camera.left = -100;
        sun.shadow.camera.right = 100;
        sun.shadow.camera.top = 100;
        sun.shadow.camera.bottom = -100;
        scene.add(sun);

        // --- ROBLOX BASEPLATE (Me≈ühur Kareli Zemin) ---
        const floorGeo = new THREE.PlaneGeometry(300, 300); // Daha geni≈ü harita
        const floorMat = new THREE.MeshPhongMaterial({ color: 0x3b3b3b }); 
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);

        // Izgara (Grid) - Tam Roblox havasƒ± verir
        const grid = new THREE.GridHelper(300, 60, 0x555555, 0x444444);
        scene.add(grid);

        // --- KARAKTER (R6 Tipi Roblox Karakteri) ---
        const playerGroup = new THREE.Group();
        scene.add(playerGroup);

        function createPart(w, h, d, color, x, y, z) {
            const geo = new THREE.BoxGeometry(w, h, d);
            const mat = new THREE.MeshPhongMaterial({ color: color });
            const part = new THREE.Mesh(geo, mat);
            part.position.set(x, y, z);
            part.castShadow = true;
            return part;
        }

        const torso = createPart(1, 1.2, 0.5, 0x0055ff, 0, 1.6, 0); // G√∂vde (Mavi)
        const head = createPart(0.8, 0.8, 0.8, 0xffcc00, 0, 2.6, 0); // Kafa (Sarƒ±, daha b√ºy√ºk)
        const lArm = createPart(0.5, 1.2, 0.5, 0xffcc00, -0.8, 1.6, 0); // Sol Kol
        const rArm = createPart(0.5, 1.2, 0.5, 0xffcc00, 0.8, 1.6, 0); // Saƒü Kol
        const lLeg = createPart(0.5, 1.2, 0.5, 0x333333, -0.25, 0.6, 0); // Sol Bacak
        const rLeg = createPart(0.5, 1.2, 0.5, 0x333333, 0.25, 0.6, 0); // Saƒü Bacak

        playerGroup.add(torso, head, lArm, rArm, lLeg, rLeg);
        playerGroup.position.y = 0; // Yere basƒ±yor

        // Kamera Takibi
        const cameraOffset = new THREE.Vector3(0, 5, 10);
        
        // --- Fƒ∞Zƒ∞K VE HAREKET DEƒûƒ∞≈ûKENLERƒ∞ ---
        let velocityY = 0;
        let isJumping = false;
        const gravity = -0.015;
        const jumpForce = 0.4;
        let currentSpeed = 0.2; // Normal hƒ±z
        const runSpeed = 0.4; // Ko≈üma hƒ±zƒ±
        let yaw = 0, pitch = 0;

        // Kontroller
        const keys = {};
        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            if (e.code === 'KeyP') togglePhone();
        });
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        let pointerLocked = false;
        document.body.addEventListener('click', () => {
            if (!isPhoneOpen) { // Telefon a√ßƒ±k deƒüilse fareyi kilitle
                document.body.requestPointerLock();
            }
        });

        document.addEventListener('pointerlockchange', () => {
            pointerLocked = document.pointerLockElement === document.body;
            document.getElementById('gui').classList.toggle('hidden', pointerLocked);
            document.getElementById('crosshair').style.display = pointerLocked ? 'block' : 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (pointerLocked) {
                yaw -= e.movementX * 0.003;
                pitch -= e.movementY * 0.003;
                pitch = Math.max(-0.8, Math.min(0.5, pitch)); // Bakƒ±≈ü a√ßƒ±larƒ±nƒ± sƒ±nƒ±rla
                playerGroup.rotation.y = yaw;
            }
        });

        // --- PARKUR BLOKLARI (OBSTACLES) ---
        const obstacles = [];
        const spawnPoint = new THREE.Vector3(0, 0, 0); // Ba≈ülangƒ±√ß noktasƒ±

        function createObstacle(w, h, d, color, x, y, z, isKillPart = false) {
            const geo = new THREE.BoxGeometry(w, h, d);
            const mat = new THREE.MeshPhongMaterial({ 
                color: color, 
                emissive: isKillPart ? 0xff0000 : 0x000000, 
                emissiveIntensity: isKillPart ? 0.7 : 0 
            });
            const block = new THREE.Mesh(geo, mat);
            block.position.set(x, y, z);
            block.castShadow = true;
            block.receiveShadow = true;
            block.userData = { isKillPart: isKillPart, collider: new THREE.Box3().setFromObject(block) }; // √áarpƒ±≈üma kutusu
            scene.add(block);
            obstacles.push(block);
            return block; // Blok referansƒ±nƒ± d√∂nd√ºr
        }

        // Basit bir parkur taslaƒüƒ± olu≈üturalƒ±m
        createObstacle(4, 1, 4, 0x00ff00, 0, 0.5, -10);
        createObstacle(3, 1, 3, 0x0000ff, 5, 2.5, -15);
        createObstacle(4, 1, 4, 0xffff00, 0, 4.5, -20);
        createObstacle(6, 0.5, 6, 0xff0000, -8, 0.25, -25, true); // LAV!
        createObstacle(3, 1, 3, 0xffa500, 10, 6.5, -30);
        createObstacle(2, 1, 2, 0x800080, 15, 8.5, -35);
        createObstacle(8, 0.5, 8, 0xff0000, 0, 0.25, -45, true); // B√ºy√ºk lav alanƒ±
        createObstacle(4, 1, 4, 0x00ffff, -10, 2.5, -50);
        createObstacle(5, 1, 5, 0xff00ff, -15, 4.5, -55);

        // Ekstra, daha zorlayƒ±cƒ± rastgele bloklar
        for (let i = 0; i < 50; i++) {
            const size = Math.random() * 3 + 1;
            const height = Math.random() * 10 + 0.5;
            const color = Math.random() * 0xffffff;
            const x = Math.random() * 200 - 100;
            const z = Math.random() * -150 - 20; // Ba≈ülangƒ±√ßtan daha uzak
            const isLava = Math.random() < 0.05; // %5 lav olma ihtimali
            createObstacle(size, size, size, color, x, height / 2, z, isLava);
        }

        // --- NPC ARKADA≈ûLAR (Basit Duru≈ülu Karakterler) ---
        function createNPC(x, y, z, headColor, torsoColor, armLegColor) {
            const npcGroup = new THREE.Group();
            npcGroup.position.set(x, y, z);

            const npcTorso = createPart(1, 1.2, 0.5, torsoColor, 0, 1.6, 0);
            const npcHead = createPart(0.8, 0.8, 0.8, headColor, 0, 2.6, 0);
            const npcLArm = createPart(0.5, 1.2, 0.5, armLegColor, -0.8, 1.6, 0);
            const npcRArm = createPart(0.5, 1.2, 0.5, armLegColor, 0.8, 1.6, 0);
            const npcLLeg = createPart(0.5, 1.2, 0.5, armLegColor, -0.25, 0.6, 0);
            const npcRLeg = createPart(0.5, 1.2, 0.5, armLegColor, 0.25, 0.6, 0);

            npcGroup.add(npcTorso, npcHead, npcLArm, npcRArm, npcLLeg, npcRLeg);
            scene.add(npcGroup);
            return npcGroup;
        }

        // Ba≈ülangƒ±√ßta birka√ß arkada≈ü
        createNPC(5, 0, 5, 0xff00ff, 0x00ff00, 0xffffff); // Mor kafa, ye≈üil g√∂vde
        createNPC(-5, 0, 5, 0x00ffff, 0xff0000, 0x000000); // Turkuaz kafa, kƒ±rmƒ±zƒ± g√∂vde
        createNPC(10, 0, 10, 0xffa500, 0x800080, 0x00ff00); // Turuncu kafa, mor g√∂vde
        createNPC(-10, 0, 10, 0x888888, 0x0000ff, 0xffd700); // Gri kafa, mavi g√∂vde
        
        // --- TELEFON MODU ---
        const phoneOverlay = document.getElementById('phone-overlay');
        const phoneCameraButton = document.getElementById('phone-camera-button');
        let isPhoneOpen = false;

        function togglePhone() {
            isPhoneOpen = !isPhoneOpen;
            phoneOverlay.style.display = isPhoneOpen ? 'block' : 'none';
            if (isPhoneOpen) {
                document.exitPointerLock(); // Telefon a√ßƒ±lƒ±nca fareyi serbest bƒ±rak
            }
        }

        phoneCameraButton.addEventListener('click', () => {
            // Telefonun i√ßinde resim √ßekme sim√ºlasyonu
            console.log("Fotoƒüraf √ßekildi!");
            // Ger√ßek bir fotoƒüraf √ßekmek i√ßin canvas'ƒ± kullanabiliriz, ancak bu sadece bir sim√ºlasyon
            phoneCameraButton.innerHTML = 'üì∏ √áekildi!';
            setTimeout(() => {
                phoneCameraButton.innerHTML = 'üì∏';
            }, 1000);
        });

        // --- OYUN D√ñNG√úS√ú ---
        function animate() {
            requestAnimationFrame(animate);

            // Ko≈üma ve Y√ºr√ºme
            currentSpeed = keys['ShiftLeft'] ? runSpeed : 0.2;
            if (keys['KeyW']) playerGroup.translateZ(-currentSpeed);
            if (keys['KeyS']) playerGroup.translateZ(currentSpeed);
            if (keys['KeyA']) playerGroup.translateX(-currentSpeed);
            if (keys['KeyD']) playerGroup.translateX(currentSpeed);

            // Zƒ±plama ve Yer√ßekimi
            if (keys['Space'] && !isJumping && playerGroup.position.y <= 0.01) { // Yerdeyken zƒ±pla
                velocityY = jumpForce;
                isJumping = true;
            }

            playerGroup.position.y += velocityY;
            velocityY += gravity;

            // Zemin √ßarpƒ±≈ümasƒ±
            if (playerGroup.position.y <= 0) {
                playerGroup.position.y = 0;
                velocityY = 0;
                isJumping = false;
            }

            // Basit √áarpƒ±≈üma Kontrol√º (Daha iyi bir fizik motoru olmadan tam doƒüru olmaz)
            const playerHeight = 2; // Karakterin y√ºksekliƒüi
            const playerRadius = 0.5; // Karakterin yarƒ±√ßapƒ± (yakla≈üƒ±k)

            obstacles.forEach(block => {
                const blockBox = block.userData.collider;
                const playerBox = new THREE.Box3().setFromCenterAndSize(
                    new THREE.Vector3(playerGroup.position.x, playerGroup.position.y + playerHeight / 2, playerGroup.position.z),
                    new THREE.Vector3(playerRadius * 2, playerHeight, playerRadius * 2)
                );

                if (playerBox.intersectsBox(blockBox)) {
                    if (block.userData.isKillPart) {
                        playerGroup.position.copy(spawnPoint); // Ba≈ülangƒ±ca d√∂n
                        velocityY = 0;
                        isJumping = false;
                    } else {
                        // Eƒüer blokun √ºst√ºndeyse
                        if (playerGroup.position.y >= block.position.y + block.geometry.parameters.height / 2 - 0.1) {
                            playerGroup.position.y = block.position.y + block.geometry.parameters.height / 2;
                            velocityY = 0;
                            isJumping = false;
                        }
                    }
                }
            });

            // Kamera takibi (Karakterin arkasƒ±ndan bakƒ±≈ü)
            const relativeCameraOffset = new THREE.Vector3(0, 4, 8);
            const cameraPosition = relativeCameraOffset.applyMatrix4(playerGroup.matrixWorld);
            camera.position.x = cameraPosition.x;
            camera.position.y = cameraPosition.y;
            camera.position.z = cameraPosition.z;
            camera.lookAt(playerGroup.position.x, playerGroup.position.y + 2, playerGroup.position.z);
            
            // Telefon kamerasƒ± da oyuncuyu takip etsin
            if (isPhoneOpen) {
                phoneCamera.position.copy(playerGroup.position);
                phoneCamera.position.y += 3; // Biraz yukarƒ±dan baksƒ±n
                phoneCamera.lookAt(playerGroup.position.x, playerGroup.position.y + 1, playerGroup.position.z - 10); // ƒ∞leriye baksƒ±n
                phoneRenderer.render(scene, phoneCamera);
            }

            renderer.render(scene, camera);
        }
        animate();

        // Pencere yeniden boyutlandƒ±ƒüƒ±nda
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);

            // Telefon kamera boyutu da ayarlanmalƒ±
            phoneCamera.aspect = 250 / (450 - 70);
            phoneCamera.updateProjectionMatrix();
            phoneRenderer.setSize(250, 450 - 70);
        });
    </script>
</body>
</html>